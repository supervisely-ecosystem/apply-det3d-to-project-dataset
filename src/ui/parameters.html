<sly-card title="Inference settings"
          class="mr15 "
          :class="{'custom-full-height': !state.collapsed4}"
          :options="{collapsable: true}"
          :collapsed.sync="state.collapsed4"
          :disabled="{disabled: state.disabled4, message: 'complete stage 3'}"
          ref="step4">

        <div>
            <sly-field title="Output project name"
                       description="Project name to store inference result">
                <el-input placeholder="Labeled project name"
                          v-model="state.newProjName"
                          :disabled="data.done4"
                          style="width: 250px;"></el-input>
            </sly-field>


            <sly-field title="Confidence threshold"
                       description="to filter predictions by confidence score">
                <div class="fflex">
                    <el-input-number v-model="state.confThres" :min="0" :max="1" :step="0.01"
                                     :disabled="data.done4"></el-input-number>
                </div>
            </sly-field>


            <sly-field title="How to add predictions"
                   description="Original annotations are not modified. New project with predictions will be created.">
                <el-select v-model="state.addMode" style="width: 250px;" :disabled="data.done4" >
                    <el-option key="replace" label="replace existing labels" value="replace"></el-option>
                    <el-option key="merge" label="merge with existing labels" value="merge"></el-option>
                </el-select>
            </sly-field>

            <sly-field title="Data manipulations for inference" description="Recommended only for advanced users.">
                <el-checkbox v-model="state.useDefaultInferenceParams" :disabled="data.doneData">Use default data settings (recommended)</el-checkbox>
                <div v-if="!state.useDefaultInferenceParams">
                    <sly-field title="Apply sliding window mode">
                        <sly-field title="INFO:"
                            description="Description"
                            style="padding-top: 0; padding-bottom: 0; margin: 10px 5px;">
                
                            <sly-icon slot="icon" :options="{ color: '#cece66', bgColor: '#f7f7eb', rounded: false }">
                                <i class="zmdi zmdi-info"></i>
                            </sly-icon>
                        </sly-field>
                        <div v-for="(coord, i) in data.coords" class="mb5">
                            <el-checkbox 
                                @change="state.idx_to_change = i; command('change_sw');" 
                                v-model="state.applySW[i]" 
                                :disabled="data.doneData || !state.allowSW[i]"
                            >
                                {{ coord }}
                                <span v-if="!state.allowSW[i]"> (Not available for this model)</span>
                            </el-checkbox>
                        </div>
                    </sly-field>
                    <sly-field title="Center point clouds">
                        <sly-field title="INFO:"
                            description="Description"
                            style="padding-top: 0; padding-bottom: 0; margin: 10px 5px;">
                
                            <sly-icon slot="icon" :options="{ color: '#cece66', bgColor: '#f7f7eb', rounded: false }">
                                <i class="zmdi zmdi-info"></i>
                            </sly-icon>
                        </sly-field>
                        <div v-for="(coord, i) in data.coords" class="mb5">
                            <el-checkbox 
                                v-model="state.applyCenterPTC[i]" 
                                :disabled="data.doneData || state.disabledCenter[i]"
                            >
                                {{ coord }}
                                <span v-if="state.disabledCenter[i]"> (Not available to change)</span>
                            </el-checkbox>
                        </div>
                    </sly-field>
                </div>
            </sly-field>


    <el-button type="primary" class="regular mt10"
               @click="command('apply_parameters')"
               v-if="!data.done4">
        Apply settings
    </el-button>



    <div v-if="data.done4">
        <i class="zmdi zmdi-check-circle mr5 mt5 mb5" style="color: #13ce66"></i>
        <span style="color: #5a6772;">Parameters defined</span>
    </div>
    <el-button type="warning" class="regular mt10" :plain="true"
               @click="state.restartFrom = 4;"
               v-if="data.done4"
               :disabled="state.visualizingStarted">
        <i class="zmdi zmdi-rotate-left mr5"></i> reselect
    </el-button>
</sly-card>